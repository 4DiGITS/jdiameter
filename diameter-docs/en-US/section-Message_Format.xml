<?xml version='1.0' encoding='UTF-8'?>
<!-- This document was created with Syntext Serna Free. --><!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "docbookV4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Diameter_User_Guide.ent">
%BOOK_ENTITIES;]>
<section id="mf-Message_Format">
  <title>Message Format</title>
  <para>Each message that is sent and received using Diameter is comprised according to  a consistent structure.  A Diameter message always contains message headers, and the message payload.   </para>
  <figure>
    <title>Diameter Message Structure</title>
    <mediaobject>
      <imageobject>
        <imagedata fileref="images/dia-Introduction-dia-DiameterPacketFormat.png" format="PNG"/>
      </imageobject>
    </mediaobject>
  </figure>
  <para>Within the message, several headers are present:</para>
  <variablelist>
    <title>Message Headers</title>
    <varlistentry>
      <term>Version</term>
      <listitem>
        <para>Indicates the Diameter protocol version.  This value is always set to <literal>1</literal>.</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>Message Length</term>
      <listitem>
        <para>Indicates the Diameter message length, including the header fields.</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>Command Flags</term>
      <listitem>
        <para>Bits that specify the type of message.  The first four bits are occupied with any one of the following values: </para>
        <itemizedlist>
          <listitem>
            <para>R = Message is a request</para>
          </listitem>
          <listitem>
            <para>P = Message is proxiable</para>
          </listitem>
          <listitem>
            <para>E = Message is an error message</para>
          </listitem>
          <listitem>
            <para>T = Message is potentially retransmitted</para>
          </listitem>
        </itemizedlist>
        <para>The last four bits are reserved for future use, and should be set to <literal>0</literal></para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>Command Code</term>
      <listitem>
        <para>Indicates the command associated with the message, such as what type of message it is.</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>Application ID</term>
      <listitem>
        <para>Identifies which application the message is applicable to.  The application can be an authentication, accounting, or vendor-specific application.</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>Hop-by-Hop ID</term>
      <listitem>
        <para>Unique ID that is used to match requests and replies.  The Answer message must ensure this header  field contains the same value present in the  corresponding request.</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>End-to-End ID</term>
      <listitem>
        <para>Time-limited unique ID that is used to to detect duplicate messages.  The ID must be unique for at least four minutes.  The Answer message originator must ensure that this header contains the same value present in the corresponding request.</para>
      </listitem>
    </varlistentry>
  </variablelist>
  <para>The message contents (payload) is comprised of Attribute Value Pairs (AVPs), which also have their own header and data.</para>
  <figure>
    <title>Payload Structure</title>
    <mediaobject>
      <imageobject>
        <imagedata fileref="images/dia-Introduction-dia-DiameterAVPLayout.png" format="PNG"/>
      </imageobject>
    </mediaobject>
  </figure>
  <variablelist>
    <title>Payload AVPs</title>
    <varlistentry>
      <term>AVP Code</term>
      <listitem>
        <para>Uniquely identifies the attribute, by combining the specified code with the value contained within the Vendor-ID header field.  </para>
        <para>AVP numbers 1 to 255 are reserved for RADIUS backwards compatibility, and do not require the Vendor-ID header field.  AVP numbers 256 and above are used exclusively for the Diameter protocol, and are allocated by <orgname>IANA</orgname>.</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>AVP Flags</term>
      <listitem>
        <para>Specify how each attribute must be handled.  The first three  bits are occupied with any one of the following values: </para>
        <itemizedlist>
          <listitem>
            <para>V = Message is an error message.</para>
          </listitem>
          <listitem>
            <para>M = Message is proxiable.</para>
          </listitem>
          <listitem>
            <para>P = Message is a request.</para>
          </listitem>
        </itemizedlist>
        <para>The last 5 bits are reserved for future use, and should be set to <literal>0</literal></para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>AVP Length</term>
      <listitem>
        <para>Indicates the number of octets in the AVP, including the following information:</para>
        <itemizedlist>
          <listitem>
            <para>AVP Code</para>
          </listitem>
          <listitem>
            <para>AVP Length</para>
          </listitem>
          <listitem>
            <para>AVP Flags</para>
          </listitem>
          <listitem>
            <para>Vendor-ID field (if present)</para>
          </listitem>
          <listitem>
            <para>AVP Data</para>
          </listitem>
        </itemizedlist>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>Vendor-ID</term>
      <listitem>
        <para>Optional field that identifies which application the message is applicable to.  The application can be either an authentication, accounting, or vendor-specific application.</para>
      </listitem>
    </varlistentry>
  </variablelist>
</section>
