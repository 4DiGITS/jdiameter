<?xml version='1.0' encoding='UTF-8'?>
<!-- This document was created with Syntext Serna Free. --><!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "docbookV4.5/docbookx.dtd" []>
<section id="dr-Diameter_Ro">
  <title>Mobicents Diameter Ro</title>
  <para>Ro is one of two IMS reference points for charging. It covers online charging - scenarios  where charging information can affect, in real-time, the service rendered.  In other words Ro is application used in cases when service provider(or platform) ensures that user has enough units to cover ongoing activity. </para>
  <para>Therefore, a direct interaction between the charging mechanism and the session/service control is required.</para>
  <para>For contrast with Rf (which is almost identical) consider the regular phone call. User accessing platform is <emphasis role="bold">regular user</emphasis> - that means he is bound to regular phone plan. Provider charges him on every activity during call - call start, every n-service units and finally on call end. This allows to deny service during (here a phone call) if user account does not have enough credit.</para>
  <para>Ro is defined in <ulink url="http://www.3gpp.org/ftp/Specs/html-info/32299.htm">TS32.299</ulink>.</para>
<!--Note: Developer: The link between the CTF and the OCF needs to be explained better. If the CTF makes the decisions then the OCF carries the decisions out, then that needs to be clarified so that we can make sense of it.
Content: para inserted below.-->  <para>Charging involves two peers:</para>
  <itemizedlist>
    <listitem>
      <para>Charging Trigger Function (CTF) - makes decisions on how to charge the user for specific services, issues requests to the server (OCF). </para>
    </listitem>
    <listitem>
      <para>Online Charging Function (OCF) - performs actual charging based on received message type, service logic and user profile information.</para>
    </listitem>
  </itemizedlist>
  <para>Where CTF is part of service element (Application Server) it is responsible for monitoring service usage and generatios of charging events. Those events are consumed by OCF. OCF perfroms certain operations which produce result returned to CTF. Based on result CTF grants or denies access to service.</para>
  <para>The Ro application does not define new FSMs or messages. It makes use of commands, AVPs and FSMs defined by the base CCA application. Please refer to <!--TODO: add ref here, not sure how to handle this, some refs are broken, Jared?--> </para>
  <para>The Ro RA is responsible for managing states associated with different charging scenarios. The 3GPP TS32.299 defines the following online scenarios:</para>
  <itemizedlist>
    <listitem>
      <para>Immediate Event Charging (IEC) - the CTF sends  a one time request. This request contains a predefined set of AVPs indicating which service has been activated or how many units have been consumed (this depends on application logic)</para>
    </listitem>
    <listitem>
      <para>Event Charging with Unit Reservation (ECUR) - the CTF issues a request which indicates the  desired unit count for reservation. On service delivery, the CTF issues another request which indicates how many units were actually consumed. Units can be of any type, as they are application specific.</para>
    </listitem>
    <listitem>
      <para>Session Charging with Unit Reservation(SCUR) - as above, however reservation can happen more than once.</para>
    </listitem>
  </itemizedlist>
  <para>As per the definition  in the technical specification, Ro reuses messages defined by the  CCA application. For more information about CCA please refer to <xref linkend="dcca-Diameter_CCA"/> </para>
  <figure id="ro-Figure_IEC_Flow">
    <title>IEC Example Flow</title>
    <mediaobject>
      <imageobject>
        <imagedata fileref="images/dia-RoExamples-dia-IECFlow.jpg" format="JPG"/>
      </imageobject>
    </mediaobject>
  </figure>
  <para>The above figure is an example of IEC interaction. Actions performed in the diagram can be described as follows:</para>
  <itemizedlist>
    <listitem>
      <para>(1)UA issues  service request - be it SMS, MMS, Data chunk transfer etc </para>
    </listitem>
<!--Note: Developer: Point Two needs to be explained concisely. At the moment, the last sentence makes no sense at all.-->    <listitem>
      <para>(2) The CTF a sends proper CCR. The CC-Request-Type is set to an enum value of &quot;EVENT&quot;. This request holds indication which allows OCF to perform some actions.</para>
    </listitem>
    <listitem>
      <para>(3) The OCF processes the request.</para>
    </listitem>
    <listitem>
      <para>(4) The OCF sends the CCA back to the CTF.  If the request is accepted, the CTF grants service to UA.</para>
    </listitem>
    <listitem>
      <para>(5) Service is delivered.</para>
    </listitem>
  </itemizedlist>
  <figure id="ro-Figure_ECUR_Flow">
    <title>ECUR Example flow</title>
    <mediaobject>
      <imageobject>
        <imagedata fileref="images/dia-RoExamples-dia-ECURFlow.jpg" format="JPEG"/>
      </imageobject>
    </mediaobject>
  </figure>
  <para>The above figure shows ECUR interaction. The performed action can be described as follows:</para>
  <itemizedlist>
    <listitem>
      <para>(1) The UA issues  a service request - this is a more complex case, as the service can be something like charging for a phone call, but up to a  certain limit</para>
    </listitem>
    <listitem>
      <para>(2) The CTF sends a CCR to the OCF. The CC-Request-Type is set to an enum value of &quot;INITIAL&quot;</para>
    </listitem>
    <listitem>
      <para>(3) The OCF processes the request</para>
    </listitem>
    <listitem>
      <para>(4) The OCF then reserves a certain amount of units, and sends back the CCA with this information</para>
    </listitem>
    <listitem>
      <para>(5) The CTF grants service to the UA</para>
    </listitem>
    <listitem>
      <para>(6) The UA notifies that it does not require service any more (this does not have to happen, as it may be an AS decision)</para>
    </listitem>
    <listitem>
      <para>(7) The CTF sends a CCR to the OCF. The CC-Request-Type is set to an enum value of &quot;TERMINATION&quot;. The CCR contains information on used units</para>
    </listitem>
    <listitem>
      <para>(8) The OCF processes the request</para>
    </listitem>
    <listitem>
      <para>(9) The OCF sends back the CCA</para>
    </listitem>
    <listitem>
      <para>(10) Service delivery ends</para>
    </listitem>
  </itemizedlist>
  <figure id="ro-Figure_SCUR_Flow">
    <title>SCUR Example flow</title>
    <mediaobject>
      <imageobject>
        <imagedata fileref="images/dia-RoExamples-dia-SCURFlow.jpg" format="JPEG"/>
      </imageobject>
    </mediaobject>
  </figure>
  <para>The above diagram is an example of a  SCUR interaction. SCUR actions are exactly the same as for the  ECUR case. However SCUR allows for the  use another type of message - where CC-Request-Type is set to value of enum &quot;UPDATE&quot;. CC-Request-Type per message is as follows:</para>
  <itemizedlist>
    <listitem>
      <para>INITIAL - (2)</para>
    </listitem>
    <listitem>
      <para>UPDATE - (6),(9)</para>
    </listitem>
    <listitem>
      <para>TERMINATION - (13)</para>
    </listitem>
  </itemizedlist>
  <para>Cx/Dx interface depends on following resources:</para>
  <itemizedlist>
    <listitem>
      <para>MUX</para>
    </listitem>
    <listitem>
      <para>Base RA</para>
    </listitem>
    <listitem>
      <para>Credit Contral Application RA (CCA RA)</para>
    </listitem>
  </itemizedlist>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="section-Diameter_Ro_Configuration.xml" encoding="UTF-8"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="section-Diameter_Ro_Resource_Adapter_Type.xml" encoding="UTF-8"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="section-Diameter_Ro_API_Usage_Example.xml" encoding="UTF-8"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="section-Diameter_Ro_Examples.xml" encoding="UTF-8"/>
</section>
