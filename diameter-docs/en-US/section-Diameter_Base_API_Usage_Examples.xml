<?xml version='1.0' encoding='UTF-8'?>
<!-- This document was created with Syntext Serna Free. -->
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "docbookV4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Diameter_User_Guide.ent">
%BOOK_ENTITIES;]>
<section id="dbaue-Diameter_Base_API_Usage_Examples">
    <title>API Usage Examples</title>
    <para>The following examples demonstrate basic usage examples for the Resource Adapter (RA) API.  </para>
    <example id="example-Diameter_Base_Send_ACR">
      <title>Send ACR</title>
      <para>The following code demonstrates how to configure a Send ACR.</para>
      <programlisting role="JAVA">AccountingClientSessionActivity activity = 
 provider.createAccountingActivity();

List&lt;DiameterAvp&gt; avps = new ArrayList&lt;DiameterAvp&gt;();

avps.add(avpFactory.createAvp(Avp.SESSION_ID,
 activity.getSessionId().getBytes()));

DiameterAvp avpVendorId = avpFactory.createAvp(Avp.VENDOR_ID, 193);

DiameterAvp avpAcctApplicationId = avpFactory.createAvp(Avp.
 ACCT_APPLICATION_ID, 19302);

avps.add(avpFactory.createAvp(Avp.VENDOR_SPECIFIC_APPLICATION_ID, 
 new DiameterAvp[] { avpVendorId, avpAcctApplicationId }));

avps.add(avpFactory.createAvp(Avp.ORIGIN_HOST,
 &quot;aaa://127.0.0.1:1812&quot;.getBytes()));

avps.add(avpFactory.createAvp(Avp.ORIGIN_REALM,
 &quot;mobicents.org&quot;.getBytes()));

avps.add(avpFactory.createAvp(Avp.DESTINATION_HOST,
 &quot;aaa://127.0.0.1:21812&quot;.getBytes()));
            
avps.add(avpFactory.createAvp(Avp.DESTINATION_REALM,
 &quot;mobicents.org&quot;.getBytes()));

// Subscription ID
DiameterAvp subscriptionIdType = avpFactory.createAvp(193, 555, 0);
 DiameterAvp subscriptionIdData = avpFactory.createAvp(193, 554, 
 &quot;00001000&quot;);
            
avps.add(avpFactory.createAvp(193, 553, new DiameterAvp[] {
 subscriptionIdType, subscriptionIdData }));

// Requested Service Unit
DiameterAvp unitType = avpFactory.createAvp(193, 611, 2);

DiameterAvp valueDigits = avpFactory.createAvp(193, 617, 10L);

DiameterAvp unitValue = avpFactory.createAvp(193, 612, 
 new DiameterAvp[] { valueDigits });
            
avps.add(avpFactory.createAvp(193, 606, new DiameterAvp[] { unitType, unitValue }));

// Record Number and Type
avps.add(avpFactory.createAvp(Avp.ACC_RECORD_NUMBER, 0));

avps.add(avpFactory.createAvp(Avp.ACC_RECORD_TYPE, 1));

// Requested action
avps.add(avpFactory.createAvp(193, 615, 0));

// Service Parameter Type
DiameterAvp serviceParameterType = avpFactory.createAvp(193, 608, 0);

DiameterAvp serviceParameterValue = avpFactory.createAvp(193, 609, &quot;510&quot;);

avps.add(avpFactory.createAvp(193, 607, new DiameterAvp[] {
 serviceParameterType, serviceParameterValue }));

// Service Parameter Type
DiameterAvp serviceParameterType2 = avpFactory.createAvp(193, 608, 14);

DiameterAvp serviceParameterValue2 = avpFactory.createAvp(193, 609, &quot;20&quot;);

avps.add(avpFactory.createAvp(193, 607, new DiameterAvp[] {
 serviceParameterType2, serviceParameterValue2 }));

DiameterAvp[] avpArray = new DiameterAvp[avps.size()];

avpArray = avps.toArray(avpArray);
   if (logger.isInfoEnabled())
       logger.info(&quot;Creating Custom Message...&quot;);

   AccountingRequest ms = messageFactory.createAccountingRequest
    (avpArray);
   if (logger.isInfoEnabled()) {
       logger.info(&quot;Created Custom Message[&quot; + ms + &quot;]&quot;);
       logger.info(&quot;Sending Custom Message...&quot;);
       }
           
//setters examples
ms.setUserName(&quot;sip:xxx@overrideusername.com&quot;);
           
activity.sendAccountRequest(ms);
   if (logger.isInfoEnabled())
       logger.info(&quot;Sent Custom Message[&quot; + ms + &quot;]&quot;);</programlisting>
    </example>
    <example id="example-Diameter_Base_Receive_ACR">
      <title>Receive ACR</title>
      <para>The following code demonstrates how to configure a Receive ACR.</para>
      <programlisting role="JAVA">public void onAccountingRequest(net.java.slee.resource.
 diameter.base.events.AccountingRequest acr, 
 ActivityContextInterface aci) {
   long start = System.currentTimeMillis();
    if (logger.isInfoEnabled())
        logger.info(&quot;Accounting-Request received. [&quot; + acr + &quot;]&quot;);
        if (aci.getActivity() instanceof 
         AccountingServerSessionActivityImpl) {
            AccountingServerSessionActivityImpl assa = 
             (AccountingServerSessionActivityImpl) aci.getActivity();

            AccountingAnswer ans = assa.createAccountAnswer(acr,
             ResultCode.SUCCESS);
               if (logger.isInfoEnabled())
                   logger.info(&quot;Sending Accounting-Answer [&quot; + ans + &quot;]&quot;);

            assa.sendAccountAnswer(ans);
               if (logger.isInfoEnabled())
        logger.info(&quot;Accounting-Answer sent.&quot;);
    }
}</programlisting>
    </example>
  </section>
